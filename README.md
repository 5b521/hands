# hands

## 安装环境要求

需要安装 anaconda 或 miniconda 来进行运行环境管理，安装方式可参考链接：

https://docs.conda.io/en/latest/miniconda.html

安装和使用都需要使用到命令行，请确保命令行 cd 到和本 README 所在的目录（即项目源代码目录）

## 安装过程

> 考虑到项目包含神经网络，请考虑使用需求来安装项目依赖
> 如果仅仅想测试已训练模型的效果，通过 environment.yaml 安装依赖即可
> 如果想自行训练模型且拥有支持 cuda 的设备，请先下载安装和本项目 pytorch 版本对应的 cuda 版本（11.5），然后使用 environment_cuda.yaml 安装 python 依赖，训练模型见训练章节

解压源代码，在源代码目录下，根据使用需求使用yaml文件，让conda安装依赖：

```sh
conda env create -f environment.yaml
# for self training
# conda env create -f environment_cuda.yaml
```

## 使用项目

项目默认包含了手势数据，如果在使用过程中精确性较差，可以参考子章节进行手势录入

以下展示如何使用本项目，首先激活上文安装 python 运行环境

```sh
conda activate hands
```
然后运行如下命令来运行项目

```sh
python main.py
```

以下介绍当前项目包含的功能，使用细节也可以参考一并提交的视频演示

+ 鼠标控制，通过食指和中指的配合来进行鼠标控制。单独伸出食指，可以进行鼠标的移动；食指中指快速合拢张开，即为鼠标点击；食指中指合拢并移动，可以进行拖动。

+ 音量控制，通过对拇指和食指之间距离的识别，映射到对应的音量大小。使用时通过并拢拇指和食指激活功能，然后调节食指拇指距离来进行音量控制

+ 文档翻页，将手掌的上下左右移动映射到对应的按键，进而实现文档翻页和视频快进等功能。

+ 手势映射到应用或者网站，如何进行映射请参考下文子章节，我们已经实现的手势映射可以参考一并提交的视频演示

+ 网页/文档查看、翻页，通过手势向上、向下、向左、向右抛来进行文档的上画、下滑，向前翻页、向后翻页

+ 页面缩放，通过摆出放大、缩小的手势来进行页面的缩放

+ 游玩赛车游戏，项目将双手的相关手势映射到了游戏*极品飞车：热焰*中，参考子章节来尝试游玩

以下内容为更进一步的项目设置，需要使用者拥有一定的 python 使用经验

### 录入手势

录入手势，以获得更好的精准性

第一步，进入手势录入目录：

```sh
cd .\features_record\
```

第二步，通过选择性注释 `features_record\hand_features_record.py` 的文件尾部代码，选择需要录入的手势：
> 也可以自己定义手势名称，修改单引号中间的内容即可，新的手势名称可以在下文的自定义配置中使用到

第三步，运行代码，开始录制：

```sh
python .\hand_features_record.py
```

第四步，摆出你要录制的手势，例如这里录制鼠标识别手指就需要将食指伸出与其他手指合拢，确认手势正确之后，按下空格键，会显示如下界面，然后按下 Q 键即可保存：

第五步，同理录制其他手势即可

第六步，录制额外手部特征

考虑到不同用户拇指和其他手指并拢时有较大的差异，我们需要单独记录这部分特征

运行代码

```sh
python .\hand_features_record.py
```

然后摆出**拇指并拢到食指**的动作，然后按下 e 键，然后让**拇指并拢到中指**，按下 e 键，如此重复直到录入手指与小手指并拢并按下 e 键，然后按 q 键完成录入

### 自定义手势映射

项目已有的手势都存储在 `features_record/hand_features.json` 中，可以查看内容来确定已录入的手势（寻找 `tag` 键的键值）

项目支持的功能对应的 python 函数则在 `main.py` 中有展示

修改文件 `main.py` 中 `register_map` 函数返回的内容可以实现自定义手势映射，修改部分函数参数可以自定义打开的网页或者应用

### 游玩赛车游戏

确保打开该游戏的游戏画面，然后运行命令

```sh
cd .\hands_functions
python .\game_control_car.py
```

然后通过双手的高低差来调整转向，左右手拇指按下的幅度控制油门和刹车